---
layout: page
title: User Manual
permalink: /manual/
---
### Preface

Water flow in rivers is generated by rainfall and modified by landscape topography, vegetation, and soil, but also by human engineering to enhance drainage and/or retention of water. The degree to which river flow is influenced by land cover change (‘deforestation’, ‘reforestation’, ‘agroforestation’, and other code words) is hotly debated, as is the influence of ‘climate change’. A simple tool that relates the logic at the plot level to the river-level consequences was deemed relevant to assist in the analysis of catchment data. Existing models were either too complex and data-hungry or left out important processes, such as the impact of land use change in the soil and its physical condition.

GenRiver is a generic river flow model that responds to spatially explicit rainfall and keeps track of a plot-level water balance that responds to changes in vegetation and soil. The model treats a river as a summation of streams, each originating in a sub-catchment with its own daily rainfall, yearly land cover fractions, and routing time based on the distance to the river outflow (or measurement) point. Interactions between streams in their contribution to the river are considered to be negligible (i.e. there is no 'backflow' problem). Spatial patterns in daily rainfall events are translated into average daily rainfall in each sub-catchment in a separate module (Spatrain). The sub-catchment model represents interception, infiltration into the soil, rapid percolation into the subsoil, the surface flow of water, and rapid lateral subsurface flow into streams with parameters that can vary between land cover classes.

## General Information

### GenRiver Model Overview

Land cover change can significantly affect watershed functions through a) changes in the fraction of rainfall that reaches the ground, b) the subsequent path-ways of water flow over and through the soil as related to surface and subsurface structure of the soil, surface roughness, and landscape drainage, and c) the rate of water use by plants (Fig. 1.1). 

<figure>
  <img src="../docs/images/model1.png" width="400"/>
  <figcaption><b>Figure 1.1</b> Multiple influences of tree cover and (forest) soil condition in terms of the water balance.</figcaption>
</figure>

Simple characteristics of the vegetation (monthly pattern of leaf biomass, influencing canopy interception and transpiration, and ability to extract water from deeper soil layers) and soil (especially compaction of the macro pores in the soil that store water between ‘saturation’ and ‘field capacity’) can probably explain a major part of the impacts on river flow.

Empirical assessment of the dynamics of water flows as a function of land cover change and soil properties takes time and resources, and needs to take temporal and spatial variation of rainfall into account. A model based on ‘first principles’ that integrates land cover change and change in soil properties as driving factors of changes in river flow can be used as a tool to explore scenarios of land use change if it passes a ‘validation’ test against observed data.

<figure>
  <img src="../docs/images/model2.png" width="400"/>
  <figcaption><b>Figure 1.2</b> Landscape-scale processes that relate the spatial and temporal aspects of rainfall to river flow.</figcaption>
</figure>

GenRiver is a generic river model on river flow.  As is common in hydrology, it starts the accounting with rainfall or precipitation (P) and traces the subsequent flows and storage in the landscape, which can lead to either evapotranspiration (E), river flow (Q), or change in storage (ΔS) (Figure 1.3):

P = Q + E + ΔS

Models differ in the relations between the different terms of the balance equation and in the way they account for the ‘slow flows’, that derive from water that infiltrates into the soil but can take a range of pathways, with various residence times, to reach the streams and rivers, depending on landform, geology and extractions along the way.

The core of the GenRiver model is a ‘patch’ level representation of a daily water balance, driven by local rainfall and modified by the land cover and land cover change and soil properties of the patch.  The patch can contribute to three types of stream flow: surface-quick flow on the day of the rainfall event, soil-quick flow on the next day, and base flow, via the gradual release of groundwater.

A river is treated as a summation of streams, each originating in a sub-catch¬ment with its own daily rainfall, yearly land cover fractions, and constant total area and distance to the river outflow (or measurement) point.  Interactions between streams in their contribution to the river are considered to be negligible (i.e. there is no ‘backflow’ problem).  Spatial patterns in daily rainfall events are translated into average daily rainfall in each sub-catchment.  The sub-catchment model represents interception, infiltration into the soil, rapid percolation into the subsoil, the surface flow of water, and rapid lateral subsurface flow into streams with parameters that can vary between land cover classes.

<figure>
  <img src="../docs/images/model3.png" width="400"/>
  <figcaption><b>Figure 1.3</b> Overview of the GenRiver model; the multiple subcatchments that make up the catchment as a whole can differ in basic soil properties, land cover fractions that affect interception, soil structure (infiltration rate), and seasonal pattern of water use by the vegetation. The sub-catchment will also typically differ in ‘routing time’ or in the time it takes the streams and river to reach the observation point of main interest.</figcaption>
</figure>

<figure>
  <img src="../docs/images/model4.png" width="400"/>
  <figcaption><b>Figure 1.4</b> GenRiver model, key types of input, and main output.</figcaption>
</figure>

### How to run the software

GenRiver3 software is web application and the **online** version is available at: https://genriver.agroforestri.id/

The software can also be launched as a standalone app using R and RStudio. Following is the step-by-step to run the software from the source code as a standalone app.

#### Installation Instructions
1. Install R from [CRAN](https://cran.r-project.org/).
2. Install RStudio from [RStudio](https://www.rstudio.com/products/rstudio/download/).
3. Install the Shiny package in R:
    ```R
    install.packages("shiny")
    ```

#### Launching the App
1. Open RStudio.
2. Load the Shiny library:
    ```R
    library(shiny)
    ```
3. Run the app directly from GitHub source code:
    ```R
    shiny::runGitHub("genriver", "degi")
    ```
    Another option is to download all the source codes from https://github.com/degi/genriver. Extract all files to a local folder and execute the script below 
    ```R
    runApp("path/to/your/app")
    ```
    > If you have the **source code** on the local folder, you will need an internet connection to run it for the first time. An internet connection is required for updating and initializing the R libraries. Once the updates are completed, you will be able to run the app **without an internet connection**.<br/>
    > *To be noted*: An internet connection might still be required for downloading the DEM. You can go without the internet once you have it in your saved parameters. 

## User Interface Overview

### Home

<img src="../docs/images/home.png" width="400"/>

### Input

### Simulation


*To be updated...*
